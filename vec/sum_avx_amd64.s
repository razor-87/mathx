#include "textflag.h"

TEXT Â·sumAVXFloat64(SB), NOSPLIT, $0-24
	MOVQ   xs+0(FP), DI
	MOVQ   xs+8(FP), SI

	VZEROALL

LOOP:
	VADDPD    (DI), Y0, Y0
	VADDPD  32(DI), Y1, Y1
	VADDPD  64(DI), Y2, Y2
	VADDPD  96(DI), Y3, Y3
	VADDPD 128(DI), Y4, Y4
	VADDPD 160(DI), Y5, Y5
	VADDPD 192(DI), Y6, Y6
	VADDPD 224(DI), Y7, Y7
	VADDPD 256(DI), Y8, Y8
	VADDPD 288(DI), Y9, Y9
	VADDPD 320(DI), Y10, Y10
	VADDPD 352(DI), Y11, Y11
	VADDPD 384(DI), Y12, Y12
	VADDPD 416(DI), Y13, Y13
	VADDPD 448(DI), Y14, Y14
	VADDPD 480(DI), Y15, Y15

	ADDQ $512, DI
	SUBQ $64, SI
    JNZ LOOP

	VADDPD       Y1, Y2, Y1
	VADDPD       Y3, Y4, Y3
	VADDPD       Y5, Y6, Y5
	VADDPD       Y7, Y8, Y7
	VADDPD       Y9, Y10, Y9
	VADDPD       Y11, Y12, Y11
	VADDPD       Y13, Y14, Y13
	VADDPD       Y1, Y3, Y1
	VADDPD       Y5, Y7, Y5
	VADDPD       Y9, Y11, Y9
	VADDPD       Y13, Y15, Y13
	VADDPD       Y1, Y5, Y1
	VADDPD       Y9, Y13, Y9
	VADDPD       Y1, Y9, Y1
	VADDPD       Y0, Y1, Y0

	VEXTRACTF128 $0x01, Y0, X1
	VADDPD       X0, X1, X0
	VHADDPD      X0, X0, X0
	MOVSD X0, ret+24(FP)

	RET
